Задача тестирующей системы "--- обрабатывать полученные посылки, используя подготовленные заранее для каждой задачи тесты. Делать это тестирующая система должна в онлайновом режиме, то есть как только посылка была получена, она сразу должна быть автоматически отправлена на проверку, и как можно быстрее по ней должен быть получен вердикт. Это нужно для того, чтобы непосредственно во время соревнования участники имели возможность видеть результаты той или иной своей посылки и делать из них некоторые выводы.

Таким образом, от тестирующей системы требуется сколь возможно быстрое выполнение её работы, потому что во время соревнование нагрузка на систему может быть очень большой: количество посылок и частота их появления могут быть очень велики. Поэтому при реализации системы используют распараллеливание её задач. Например, можно выделять под проверку каждой новой посылки отдельный поток, потому что проверки двух отдельных посылок никак не зависят друг от друга. В более сложном варианте реализации тестирующей системы отдельный поток выделяется для проверки некоторой посылки на отдельном тесте, но в таком случае необходимо реализовывать приоритизацию потоков выполнения, чтобы одновременно могли проверяться тесты для разных посылок.

Существует определённый алгоритм проверки посылки на тестах, по окончании которого тестирующая система должна присвоить посылке один из возможных вердиктов. Важным понятием является также выбранная система оценивания, от которой зависят многие аспекты работы тестирующей системы, в том числе, например, порядок проверки посылки на отдельных тестах. Кроме того, тестирующая система должна поддерживать использование различных языков программирования и, соответственно, компиляторов, а запуск решений из командной строки в отдельном процессе должен происходить безопасно, чтобы запущенная программа участника не нанесла вред машине, на которой работает сама тестирующая система. Рассмотрим каждый из перечисленных аспектов более подробно.

\subsection*{Вердикты}

В общем случае в разных тестирующих системах приняты разные наборы возможных вердиктов, которые система может присвоить полученным посылкам. Перечислим основные виды вердиктов:

\begin{itemize}
\item \texttt{ACCEPTED} "--- означает, что решение дало правильные ответы на всех тестах по задаче и что решение зачтено как верное.
\item \texttt{PRETESTS ACCEPTED} "--- означает, что решение дало правильные ответы на всех претестах. Такой вердикт может быть получен во время соревнования, если после него проводится системное тестирование. Вердикт ещё не значит, что решение зачтено, как верное, потому что во время системного тестирования решение может выдать неправильный ответ на дополнительных тестах. Тогда вердикт будет обновлён.
\item \texttt{PARTIAL ACCEPTED} "--- означает, что решение дало правильные ответы на некоторых тестах и что в итоге всей посылке начислено некоторое количество очков, которое приписывается к данному вердикту дополнительно. Такой вердикт, как правило, может быть получен при системе оценивания IOI, где каждый тест может давать очки независимо от других.
\item \texttt{COMPILATION ERROR} "--- означает, что при попытке скомпилировать исходный код полученного решения произошла ошибка компиляции. В таком случае, разумеется, решение не будет запускаться ни на одном тесте.
\item \texttt{RUNTIME ERROR} "--- означает, что при попытке запустить решение на некотором тесте произошла ошибка времени выполнения, и запущенная программа была завершена с кодом выполнения, отличным от нуля.
\item \texttt{WRONG ANSWER} "--- означает, что на некотором тесте программа-решение полностью отработала, корректно завершилась и выдала некоторый ответ, но тестирующая система расценила данный ответ как неверный (либо он не совпал с эталонным решением, либо используемый в данной задаче чекер дал отрицательный результат).
\item \texttt{PRESENTATION ERROR} "--- означает, что на некотором тесте решение также выполнилось и выдало ответ, но формат ответа не совпал с требуемым в данной задаче. Такой вердикт можно получить в довольно редких случаях. Часто различие между данным вердиктом и вердиктом \texttt{WRONG ANSWER} бывает очень сложно определить, поэтому во многих тестирующих системах от него вообще отказываются и во всех случаях выводят \texttt{WRONG ANSWER}.
\item \texttt{TIME LIMIT} "--- означает, что на некотором тесте решение выполнялось слишком долго и время его выполнения превысило ограничение по данной задаче. В таком случае процесс с выполняемой программой принудительно прерывается и весь её вывод игнорируется.
\item \texttt{MEMORY LIMIT} "--- означает, что на некотором тесте решение потребовало задействовать слишком много памяти, и её количество превысило ограничение по данной задаче. Как правило, в данном случае программа завершается с аварийным кодом выполнения из-за исключения, связанным с нехваткой памяти. Любой вывод программы также игнорируется.
\item \texttt{SECURITY VIOLATED} "--- означает, что на некотором тесте программа-решение попыталась выполнить некоторые действия, запрещённые согласно условиям проведения олимпиады. Например, она могла запросить некоторое свойство операционной системы, обратиться к файловой системе или попытаться создать графический интерфейс.
\item \texttt{FAIL} "--- означает, что в процессе проверки решения произошла некоторая внутренняя ошибка тестирующей системы, из-за которой проверить решение не удалось. Например, аналогичный вердикт мог быть получен в чекере, либо неожиданно пропал тот или иной файл при запуске решения или его компиляции, и т. п.
\end{itemize}

Заметим также, что если вердикт выносится посылке, которая по той или иной причине не прошла все тесты, то к вердикту приписывается также номер первого теста, при проверке которого произошла ошибка. Эта информация также показывается участнику (сам тест, разумеется, остаётся скрытым). Помимо этого почти вместе с каждым вердиктом (где это имеет смысл) записывается ещё максимальное время и максимальная память, потребовавшиеся при обработке одного теста. Эти значения также сообщаются участнику.

Таковы вердикты, которые могут быть вынесены всей посылке в целом. Но помимо этого каждому отдельному тесту при тестировании посылки тоже присваивается некоторый вердикт, а вместе с ним "--- использованные при проверке на одном тесте время и память. Но на некоторых тестах система может вообще не запустить решение (например, если система оценивания "--- ICPC), тогда тесту вообще не присваивается никакого вердикта, либо присваивается специальный вердикт \texttt{NOT TESTED}. Всей посылке в целом обычно присваивается вердикт первого теста, проверка которого не дала положительного результата, либо \texttt{ACCEPTED}, если ни одного такого теста нет.

\subsection*{Алгоритм проверки решения}

Как уже говорилось выше, существует вполне определённый алгоритм проверки тестирующей системой одной посылки. Он частично зависит от используемой системы оценивания, но в целом имеет набор чётко выделенных шагов. Вкратце опишем их.

Начинается всё всегда с того, что тестирующая система пытается скомпилировать программу-решение, обращаясь к выбранному компилятору. Если это не удаётся, сразу посылке присваивается вердикт \texttt{COMPILATION ERROR}, и дальше никакие действия по проверке уже не выполняются.

Дальше всегда происходит проверка всех тестов, указанных в условии задачи, то есть тестов из группы \texttt{samples}. Есть правило, что если решение не даёт правильный ответ хотя бы на одном из таких тестов, всегда за решение не начисляются никакие очки. В таком случае сразу присваивается вердикт, аналогичный вердикту за первый неудачный тест.

Далее алгоритм различается в зависимости от системы оценивания. Отличия состоят в порядке запуска решения на тестах, моменте завершения проверки и выносе общего вердикта по посылке. Подробно эти отличия будут описаны ниже, в разделе о системах оценивания.

Проверка решения на одном тесте происходит следующим образом. Вначале засекается текущий момент времени и запускается уже скомпилированная программа, которой передаются во входной поток тестовые входные данные, а в выходной "--- пустой файл. Если время ожидания завершения программы превышает допустимое ограничение, программа прерывается, и тесту присваивается вердикт \texttt{TIME LIMIT}. Если программа завершилась, но с кодом выполнения, отличным от нуля, то вердикт зависит от перехваченного исключения: если ошибка была вызвана нехваткой памяти, будет вердикт \texttt{MEMORY LIMIT}, или нарушением безопасности, "--- вердикт \texttt{SECURITY VIOLATED}, а в любом другом случае "--- \texttt{RUNTIME ERROR}.

Если программа выполнилась успешно (с кодом выполнения, равным нулю) и от неё были получены выходные данные, то запускается проверка этих данных. Либо происходит сравнение вывода с эталонным ответом жюри, либо запускается чекер. В обоих случаях возможно получение одного из четырёх вердиктов: \texttt{ACCEPTED}, \texttt{PRESENTATION ERROR}, \texttt{WRONG ANSWER} и \texttt{FAIL} "--- согласно описанию результатов работы чекера в одном из предыдущих разделов. Соответствующий вердикт присваивается данному тесту.

Кроме того, вердикт \texttt{FAIL}, как уже говорилось выше, также может быть присвоен посылке в любой ситуации, когда тестирующая система не смогла корректно завершить проверку посылки.

\subsection*{Системы оценивания}

Существует две самые известные системы оценивания: IOI и ICPC \cite{wiki}. Первая широко используется на олимпиадах школьников, а вторая "--- на студенческих олимпиадах. От используемой системы оценивания зависит то, каким образом будут ранжироваться участники в таблице результатов соревнования. Кроме того, она также влияет на вынос вердиктов по посылкам и на порядок запуска решения на тестах. Существуют также и другие системы оценивания, например, на платформе Codeforces \cite{codeforces} используется своя система оценивания, во многом похожая на ICPC, но в данной работе мы не будем её рассматривать.

Если используется система оценивания ICPC, решение засчитывается верным только в том случае, если оно даёт правильные ответы на всех тестах. По итогам соревнования для каждого участника известно, какие задачи он решил, а также "--- в какой момент времени и с какой попытки он решил каждую задачу. За каждую задачу участнику начисляется штрафное время, которое вычисляется как количество минут от начала соревнования до отправки посылки с верным решением, плюс количество неудачных посылок, умноженное на двадцать минут. Штрафы суммируются по всем задачам для каждого участника, и затем все участники ранжируются в первую очередь по количеству решённых задач в порядке невозрастания, а затем "--- по штрафному времени в порядке неубывания. Таким образом получается итоговая таблица.

Как правило, соревнования такого формата проводятся без системного тестирования, то есть задачи проверяются на всех тестах непосредственно во время соревнования, и участники могут сразу видеть итоговый вердикт по своим посылкам, который в дальнейшем уже не изменится. Заметим, что так как вердикт \texttt{ACCEPTED} может быть присвоен посылке только при успешном прохождении всех тестов, если решение не прошло хотя бы один тест, все последующие проверять уже нет смысла, и тогда тестирующая система сразу выносит вердикт, аналогичный вердикту за первый неудачный тест.

Другая схема используется в системе оценивания IOI. Некоторые условия проведения олимпиад школьников могут различаться от случая к случаю, но общие правила таковы. За каждую задачу можно получить максимум некоторое количество баллов, обычно это количество равно 100. Баллы начисляются в зависимости от того, какие тесты и из какой группы успешно прошли тестирование. Для некоторых групп можно указать правило, что баллы за тесты из группы начисляются только в том случае, когда были успешно пройдены все тесты из группы, а для других "--- правило, что тесты оцениваются независимо друг от друга. Окончательным решением задачи считается последняя отправленная участником посылка по данной задаче. Таким образом, каждый участник получает за каждую задачу некоторое количество баллов. В итоговой таблице участники ранжируются в порядке невозрастания только по одному значению "--- суммарному количеству набранных баллов по всем задачам.

По той причине, что тесты могут оцениваться независимо друг от друга, в отличие от ситуации при ICPC, здесь приходится проверять решение на всех тестах вне зависимости от вердиктов, присвоенных им. Как правило, удобно выводить один и тот же вердикт для всех посылок, которые прошли обязательные тесты из группы \texttt{samples}: вердикт \texttt{PARTIAL ACCEPTED} с приписанным ему количеством набранных баллов.

\subsection*{Запуск решения}

Последний момент, о котором необходимо упомянуть, "--- это то, каким образом правильно запускать решения участников. Это во многом зависит от используемых участником языка программирования и компилятора, поскольку в использовании каждого компилятора есть свои особенности и нюансы.

В описании каждой задачи должно значиться два значения: количество миллисекунд и количество мегабайт, которые тестирующая система даёт в распоряжение программе-решению на её выполнение. Таким образом, нужно уметь отслеживать время, которое программа потратила на своё выполнение, и прерывать её, если она превысила заданное ограничение. А также нужно уметь ограничить программу в плане потребления памяти.

Помимо этого необходимо передать программе входные и выходные данные. Это можно делать двумя разными способами: либо программе перенаправляют файлы для ввода и вывода в стандартные входной и выходной поток (тогда участники могут работать с ними, как с консолью), либо участникам сообщаются имена входного и выходного файлов, и они из кода своей программы самостоятельно обращаются к их содержимому. Стоит заметить, что первый способ часто оказывается удобнее, как в плане реализации тестирующей системы (не нужно отслеживать, к каким файлам программа-решение должна иметь доступ), так и в плане написания решения участниками, так как им не приходится тратить время на написание кода для доступа к файлам.

Наконец, необходимо ещё отследить, чтобы программа участника не выполнила никаких противоправных действий и не нанесла ущерба тестирующей системе. Как правило, запускаемой программе дают минимум возможных прав, так как для решения олимпиадной задачи никакие особенные права не нужны. Обычно участникам запрещено в коде своих решений выполнять следующие действия:

\begin{itemize}
\item получать доступ к сети;
\item работать с директориями и файлами кроме тех, что определены в условии задачи;
\item считывать и изменять системные свойства;
\item запускать другие программы и создавать новые процессы;
\item создавать какие-либо компоненты графического интерфейса и манипулировать ими;
\item работать с внешними устройствами ввода-вывода;
\item работать с реестром операционной системы.
\end{itemize}